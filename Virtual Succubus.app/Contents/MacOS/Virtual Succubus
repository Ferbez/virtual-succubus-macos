#!/bin/sh

ARCHIVENAME=""

if [ ! -f "$(dirname "$0")/../Resources/prefix/drive_c/Program Files (x86)/Virtual Succubus/Virtual Succubus.exe" ]; then
	cd "$(dirname "$0")/../../.."
	while [ ! -f "$ARCHIVENAME" ]; do
		ARCHIVENAME=$(osascript -e 'set ArchiveName to text returned of (display dialog "Enter the name of VS installation archive (example: VS_0.39R3 PCFULL.zip)" default answer "VS_0.39R3 PCFULL.zip" buttons{"Continue"})')
	done
	FOLDERNAME=$(echo $ARCHIVENAME | sed 's/....$//')
	unzip "$ARCHIVENAME" -d "Virtual Succubus.app/Contents/Resources/prefix/drive_c/Program Files (x86)"
	mv "Virtual Succubus.app/Contents/Resources/prefix/drive_c/Program Files (x86)/$FOLDERNAME" "Virtual Succubus.app/Contents/Resources/prefix/drive_c/Program Files (x86)/Virtual Succubus"
	osascript -e 'display alert "Virtual Succubus is successfully installed!" message "Restart an application in order to run it."'
	exit 0
fi

if [ ! -d "$HOME/Library/Application Support/SuccuDev/" ]; then
	echo "wrapper: SuccuDev directory not present, creating one"
	mkdir "$HOME/Library/Application Support/SuccuDev/"
else
	echo "wrapper: SuccuDev directory is present, starting wrapper"
fi

cd "$(dirname "$0")/../Resources/prefix/drive_c/"

export WINEPREFIX="$(dirname "$0")/../Resources/prefix/"
export WINEARCH="win64"
export WINEDEBUG=""

../../../MacOS/wine64 "C:/Program Files (x86)/Virtual Succubus/Virtual Succubus.exe" "-force-feature-level-10-0"
